md5                     6441d7260944bcedc5958c5c8a05d16d
sha1                    46257982840493eca90e051ff1749e7040895584
sha256                  723d1cf3d74fb3ce95a77ed9dff257a78c8af8e67a82963230dd073781074224
path                    C:/Users/Dragon/Desktop/723d1cf3d74fb3ce95a77ed9dff257a78c8af8e67a82963230dd073781074224.exe
timestamp               2024-06-20 06:46:19.004277
capa version            6.1.0
os                      windows
format                  pe
arch                    i386
extractor               VivisectFeatureExtractor
base address            0x400000
rules                   C:/Users/Dragon/AppData/Local/Temp/_MEI19002/rules
function count          2482
library function count  1639
total feature count     111994

PEB access (3 matches, only showing first match of library rule)
author      michael.hunhoff@mandiant.com
scope       basic block
mbc         Anti-Behavioral Analysis::Debugger Detection::Process Environment Block [B0001.019]
references  https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiDebug/NtGlobalFlag.cpp
basic block @ 0x463BAD in function 0x463B9D
  or:
    characteristic: peb access @ 0x463BB3

allocate RW memory (2 matches, only showing first match of library rule)
author  0x534a@mailbox.org
scope   basic block
mbc     Memory::Allocate Memory [C0007]
basic block @ 0x401F39 in function 0x401E10
  and:
    match: allocate memory @ 0x401F39
      or:
        api: kernel32.VirtualProtect @ 0x401F49
    number: 0x4 = PAGE_READWRITE @ 0x401F44, 0x401F46

allocate memory (2 matches, only showing first match of library rule)
author  0x534a@mailbox.org
scope   basic block
mbc     Memory::Allocate Memory [C0007]
basic block @ 0x401F39 in function 0x401E10
  or:
    api: kernel32.VirtualProtect @ 0x401F49

contain loop (425 matches, only showing first match of library rule)
author  moritz.raabe@mandiant.com
scope   function
function @ 0x401DB0
  or:
    characteristic: loop @ 0x401DB0

create or open file (11 matches, only showing first match of library rule)
author  michael.hunhoff@mandiant.com, joakim@intezer.com
scope   basic block
mbc     File System::Create File [C0016]
basic block @ 0x4026EC in function 0x4026C0
  or:
    api: CreateFile @ 0x402703

delay execution (6 matches, only showing first match of library rule)
author      michael.hunhoff@mandiant.com, @ramen0x3f
scope       basic block
mbc         Anti-Behavioral Analysis::Dynamic Analysis Evasion::Delayed Execution [B0003.003]
references  https://docs.microsoft.com/en-us/windows/win32/sync/wait-functions, https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/TimingAttacks/timing.cpp
basic block @ 0x413280 in function 0x413280
  or:
    and:
      os: windows
      or:
        api: kernel32.WaitForSingleObject @ 0x4132A6

get OS version (4 matches, only showing first match of library rule)
author  @mr-tz
scope   function
function @ 0x401AC0
  or:
    api: RtlGetNtVersionNumbers @ 0x401B1F

open process (library rule)
author  0x534a@mailbox.org
scope   basic block
mbc     Process::Open Process [C0065]
basic block @ 0x4121FE in function 0x411F70
  or:
    api: kernel32.OpenProcess @ 0x412259

reference analysis tools strings
namespace   anti-analysis
author      michael.hunhoff@mandiant.com
scope       file
mbc         Discovery::Analysis Tool Discovery::Process detection [B0013.001]
references  https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiAnalysis/process.cpp
or:
  regex: /ida[gqtuw]?(\.exe)?$/i
    - "IDAT" @ file+0x119246, file+0x11B252, file+0x11F26A, file+0x121276, and 2 more...
    - "lIDAT" @ file+0x127299

reference anti-VM strings targeting Xen
namespace   anti-analysis/anti-vm/vm-detection
author      michael.hunhoff@mandiant.com
scope       file
att&ck      Defense Evasion::Virtualization/Sandbox Evasion::System Checks [T1497.001]
mbc         Anti-Behavioral Analysis::Virtual Machine Detection [B0009]
references  https://github.com/LordNoteworthy/al-khaser/blob/master/al-khaser/AntiVM/Xen.cpp
or:
  regex: /^Xen/i
    - "XEn#" @ file+0xA86CF

get geographical location (4 matches)
namespace  collection
author     moritz.raabe, michael.hunhoff@mandiant.com
scope      function
att&ck     Discovery::System Location Discovery [T1614]
function @ 0x4166E0
  or:
    api: GetLocaleInfoEx @ 0x41670F
function @ 0x418460
  or:
    api: GetLocaleInfoEx @ 0x4184AD
function @ 0x4184F0
  or:
    api: GetLocaleInfoEx @ 0x4185E0
function @ 0x42114B
  or:
    api: GetLocaleInfoEx @ 0x42117D

log keystrokes via polling
namespace  collection/keylog
author     michael.hunhoff@mandiant.com
scope      function
att&ck     Collection::Input Capture::Keylogging [T1056.001]
mbc        Collection::Keylogging::Polling [F0002.002]
function @ 0x418360
  or:
    api: user32.GetKeyState @ 0x418361

contains PDB path
namespace  executable/pe/pdb
author     moritz.raabe@mandiant.com
scope      file
regex: /:\\.*\.pdb/
  - "E:\\cpp\\calc\\Bin\\Release_x86_v143\\minipath.pdb" @ file+0x8DFE0

extract resource via kernel32 functions
namespace  executable/resource
author     william.ballenthin@mandiant.com
scope      function
function @ 0x417A20
  or:
    and:
      or:
        api: kernel32.LoadResource @ 0x417A4A
        api: kernel32.LockResource @ 0x417A5B
      optional:
        or:
          api: kernel32.FindResource @ 0x417A37
        api: kernel32.SizeofResource @ 0x417A6E
        api: kernel32.FreeResource @ 0x417AA0, 0x417C1A

accept command line arguments
namespace  host-interaction/cli
author     moritz.raabe@mandiant.com, anushka.virgaonkar@mandiant.com
scope      function
att&ck     Execution::Command and Scripting Interpreter [T1059]
mbc        Execution::Command and Scripting Interpreter [E1059]
function @ 0x41F3A0
  or:
    api: GetCommandLine @ 0x41F3A5

open clipboard
namespace  host-interaction/clipboard
author     michael.hunhoff@mandiant.com
scope      function
att&ck     Collection::Clipboard Data [T1115]
function @ 0x41BE50
  and:
    api: user32.OpenClipboard @ 0x41D5DE
    optional:
      api: user32.CloseClipboard @ 0x41D5FB

write clipboard data
namespace   host-interaction/clipboard
author      michael.hunhoff@mandiant.com, anushka.virgaonkar@mandiant.com
scope       function
mbc         Impact::Clipboard Modification [E1510]
references  https://learn.microsoft.com/en-us/windows/win32/dataxchg/using-the-clipboard
function @ 0x41BE50
  and:
    optional:
      match: open clipboard @ 0x41BE50
        and:
          api: user32.OpenClipboard @ 0x41D5DE
          optional:
            api: user32.CloseClipboard @ 0x41D5FB
      api: user32.EmptyClipboard @ 0x41D5EC
    or:
      api: user32.SetClipboardData @ 0x41D5F5

query environment variable (12 matches)
namespace  host-interaction/environment-variable
author     michael.hunhoff@mandiant.com, @_re_fox
scope      function
att&ck     Discovery::System Information Discovery [T1082]
mbc        Discovery::System Information Discovery [E1082]
function @ 0x404160
  or:
    api: kernel32.ExpandEnvironmentStrings @ 0x40418A
function @ 0x404320
  or:
    api: kernel32.ExpandEnvironmentStrings @ 0x4043B1
function @ 0x404450
  or:
    api: kernel32.ExpandEnvironmentStrings @ 0x4044DD
function @ 0x410EB0
  or:
    api: kernel32.ExpandEnvironmentStrings @ 0x4110E1
function @ 0x415E90
  or:
    api: kernel32.ExpandEnvironmentStrings @ 0x415F0B
function @ 0x416080
  or:
    api: kernel32.ExpandEnvironmentStrings @ 0x416152
function @ 0x416590
  or:
    api: kernel32.ExpandEnvironmentStrings @ 0x4165B5
function @ 0x41F860
  or:
    api: kernel32.ExpandEnvironmentStrings @ 0x41F8AD
function @ 0x41FAB0
  or:
    api: kernel32.ExpandEnvironmentStrings @ 0x41FBAE
function @ 0x4204A0
  or:
    api: kernel32.ExpandEnvironmentStrings @ 0x4209E4
function @ 0x467F3C
  or:
    api: kernel32.GetEnvironmentStrings @ 0x467F44
function @ 0x467FDC
  or:
    api: kernel32.GetEnvironmentStrings @ 0x467FDF

set environment variable (2 matches)
namespace  host-interaction/environment-variable
author     michael.hunhoff@mandiant.com
scope      function
mbc        Operating System::Environment Variable::Set Variable [C0034.001]
function @ 0x468778
  or:
    api: kernel32.SetEnvironmentVariable @ 0x468787
function @ 0x4688F6
  or:
    api: kernel32.SetEnvironmentVariable @ 0x4684A8

get Program Files directory
namespace  host-interaction/file-system
author     moritz.raabe@mandiant.com
scope      basic block
att&ck     Discovery::File and Directory Discovery [T1083]
basic block @ 0x415ECA in function 0x415E90
  and:
    or:
      number: 0x26 = CSIDL_PROGRAM_FILES @ 0x415ED9
    or:
      api: shell32.SHGetFolderPath @ 0x415ED3

get common file path (10 matches)
namespace  host-interaction/file-system
author     moritz.raabe@mandiant.com, michael.hunhoff@mandiant.com, anushka.virgaonkar@mandiant.com
scope      function
att&ck     Discovery::File and Directory Discovery [T1083]
mbc        Discovery::File and Directory Discovery [E1083]
function @ 0x404160
  or:
    api: shell32.SHGetFolderPath @ 0x40424F, 0x40428F
function @ 0x404B90
  or:
    api: kernel32.GetSystemDirectory @ 0x404E7A
    api: shell32.SHGetFolderPath @ 0x404E29
    api: shell32.SHGetSpecialFolderPath @ 0x404F5F
function @ 0x40DA00
  or:
    api: GetCurrentDirectory @ 0x40DABD
function @ 0x40F4F0
  or:
    api: kernel32.GetSystemDirectory @ 0x40F587
    api: kernel32.GetWindowsDirectory @ 0x40F6A7
    api: shell32.SHGetSpecialFolderLocation @ 0x40F678
function @ 0x410EB0
  or:
    api: GetCurrentDirectory @ 0x411179
function @ 0x414510
  or:
    api: shell32.SHGetSpecialFolderLocation @ 0x41457E
function @ 0x415CA0
  or:
    api: kernel32.GetWindowsDirectory @ 0x415D06
    api: shell32.SHGetFolderPath @ 0x415D19
function @ 0x415E90
  or:
    api: shell32.SHGetFolderPath @ 0x415ED3
function @ 0x41EDA0
  or:
    api: kernel32.GetWindowsDirectory @ 0x41EE09
    api: GetCurrentDirectory @ 0x41EDE8, 0x41EE74
function @ 0x41FF10
  or:
    api: GetCurrentDirectory @ 0x42000B

get file system object information (16 matches)
namespace  host-interaction/file-system
author     michael.hunhoff@mandiant.com
scope      basic block
att&ck     Discovery::File and Directory Discovery [T1083]
basic block @ 0x4130D6 in function 0x413080
  or:
    api: SHGetFileInfo @ 0x413120, 0x41314D
basic block @ 0x413320 in function 0x413320
  or:
    api: SHGetFileInfo @ 0x4133D5, 0x413404
basic block @ 0x413A08 in function 0x413860
  or:
    api: SHGetFileInfo @ 0x413A1A
basic block @ 0x4141E3 in function 0x414140
  or:
    api: SHGetFileInfo @ 0x4141F5
basic block @ 0x41A501 in function 0x41A240
  or:
    api: SHGetFileInfo @ 0x41A552
basic block @ 0x41A501 in function 0x41A240
  or:
    api: SHGetFileInfo @ 0x41A552
basic block @ 0x41C48A in function 0x41C388
  or:
    api: SHGetFileInfo @ 0x41C507
basic block @ 0x41C48A in function 0x41C388
  or:
    api: SHGetFileInfo @ 0x41C507
basic block @ 0x41CBFA in function 0x41CA74
  or:
    api: SHGetFileInfo @ 0x41CC3B
basic block @ 0x41CBFA in function 0x41CA74
  or:
    api: SHGetFileInfo @ 0x41CC3B
basic block @ 0x41EAA2 in function 0x41E3D0
  or:
    api: SHGetFileInfo @ 0x41EABB
basic block @ 0x41EEB4 in function 0x41EDA0
  or:
    api: SHGetFileInfo @ 0x41EEE0
basic block @ 0x41F9A9 in function 0x41F860
  or:
    api: SHGetFileInfo @ 0x41F9E0
basic block @ 0x41FB02 in function 0x41FAB0
  or:
    api: SHGetFileInfo @ 0x41FB6C
basic block @ 0x41FC7D in function 0x41FAB0
  or:
    api: SHGetFileInfo @ 0x41FCB5
basic block @ 0x41FDB4 in function 0x41FAB0
  or:
    api: SHGetFileInfo @ 0x41FE1A

set current directory (6 matches)
namespace  host-interaction/file-system
author     michael.hunhoff@mandiant.com
scope      function
function @ 0x41BE50
  or:
    api: kernel32.SetCurrentDirectory @ 0x41C4D0, 0x41D95D
function @ 0x41C388
  or:
    api: kernel32.SetCurrentDirectory @ 0x41C4D0
function @ 0x41D847
  or:
    api: kernel32.SetCurrentDirectory @ 0x41D95D
function @ 0x41EDA0
  or:
    api: kernel32.SetCurrentDirectory @ 0x41EDCC, 0x41EE17, 0x41F163
function @ 0x41F860
  or:
    api: kernel32.SetCurrentDirectory @ 0x41F952, 0x41FA21
function @ 0x41FAB0
  or:
    api: kernel32.SetCurrentDirectory @ 0x41FB3A, 0x41FC26, 0x41FCF6, 0x41FDE8

copy file (2 matches)
namespace  host-interaction/file-system/copy
author     moritz.raabe@mandiant.com, michael.hunhoff@mandiant.com
scope      function
mbc        File System::Copy File [C0045]
function @ 0x41BE50
  or:
    api: kernel32.CopyFile @ 0x41C84A
function @ 0x41C6E9
  or:
    api: kernel32.CopyFile @ 0x41C84A

create directory (3 matches)
namespace  host-interaction/file-system/create
author     moritz.raabe@mandiant.com, michael.hunhoff@mandiant.com
scope      function
mbc        File System::Create Directory [C0046]
function @ 0x404070
  or:
    api: SHCreateDirectoryEx @ 0x4040A2
function @ 0x41BE50
  or:
    api: kernel32.CreateDirectory @ 0x41C592
function @ 0x41C534
  or:
    api: kernel32.CreateDirectory @ 0x41C592

check if file exists (11 matches)
namespace  host-interaction/file-system/exists
author     moritz.raabe@mandiant.com, michael.hunhoff@mandiant.com
scope      function
att&ck     Discovery::File and Directory Discovery [T1083]
mbc        Discovery::File and Directory Discovery [E1083]
function @ 0x4025D0
  or:
    api: shlwapi.PathFileExists @ 0x4025D4
function @ 0x402810
  or:
    api: shlwapi.PathFileExists @ 0x402827
function @ 0x404070
  or:
    api: shlwapi.PathFileExists @ 0x4040B5
function @ 0x404160
  or:
    api: shlwapi.PathFileExists @ 0x4041CF, 0x404227, 0x40426D, 0x4042CC
function @ 0x404740
  or:
    api: shlwapi.PathFileExists @ 0x404827, 0x40484C, 0x40490F, 0x404934, and 2 more...
function @ 0x41A750
  or:
    api: shlwapi.PathFileExists @ 0x41A7A0
function @ 0x41BE50
  or:
    basic block:
      and:
        api: kernel32.GetFileAttributes @ 0x41C07C
        instruction:
          and:
            mnemonic: cmp @ 0x41C082
            number: 0xFFFFFFFF = INVALID_FILE_ATTRIBUTES @ 0x41C082
      and:
        api: kernel32.GetFileAttributes @ 0x41BF7F
        instruction:
          and:
            mnemonic: cmp @ 0x41BF85
            number: 0xFFFFFFFF = INVALID_FILE_ATTRIBUTES @ 0x41BF85
    api: shlwapi.PathFileExists @ 0x41D8FA
function @ 0x41D847
  or:
    api: shlwapi.PathFileExists @ 0x41D8FA
function @ 0x41EDA0
  or:
    api: shlwapi.PathFileExists @ 0x41EDF2
function @ 0x41F860
  or:
    basic block:
      and:
        api: kernel32.GetFileAttributes @ 0x41F937
        instruction:
          and:
            mnemonic: cmp @ 0x41F93D
            number: 0xFFFFFFFF = INVALID_FILE_ATTRIBUTES @ 0x41F93D
function @ 0x41FAB0
  or:
    basic block:
      and:
        api: kernel32.GetFileAttributes @ 0x41FC0B
        instruction:
          and:
            mnemonic: cmp @ 0x41FC11
            number: 0xFFFFFFFF = INVALID_FILE_ATTRIBUTES @ 0x41FC11
    api: shlwapi.PathFileExists @ 0x41FAE5, 0x41FD97

enumerate files on Windows (2 matches)
namespace   host-interaction/file-system/files/list
author      moritz.raabe@mandiant.com, anushka.virgaonkar@mandiant.com
scope       function
att&ck      Discovery::File and Directory Discovery [T1083]
mbc         Discovery::File and Directory Discovery [E1083]
references  https://github.com/hfiref0x/TDL/blob/cc4b46ae1c939b14a22a734a727b163f873a41b5/Source/Furutaka/sup.c#L315
function @ 0x4661C1
  or:
    and:
      or:
        api: kernel32.FindFirstFileEx @ 0x4662B1
      or:
        api: kernel32.FindNextFile @ 0x4663A5
      optional:
        api: kernel32.FindClose @ 0x4663E4, 0x466417
        match: contain loop @ 0x4661C1
          or:
            characteristic: loop @ 0x4661C1
function @ 0x466446
  or:
    and:
      or:
        api: kernel32.FindFirstFileEx @ 0x4664E1
      or:
        api: kernel32.FindNextFile @ 0x46655C
      optional:
        api: kernel32.FindClose @ 0x46657E, 0x4665A1
        match: contain loop @ 0x466446
          or:
            characteristic: loop @ 0x466446

get file attributes (8 matches)
namespace  host-interaction/file-system/meta
author     michael.hunhoff@mandiant.com, anushka.virgaonkar@mandiant.com
scope      basic block
mbc        File System::Get File Attributes [C0049]
basic block @ 0x4111E5 in function 0x410EB0
  or:
    api: kernel32.GetFileAttributes @ 0x4111ED
basic block @ 0x411CE0 in function 0x411BB0
  or:
    api: kernel32.GetFileAttributes @ 0x411CE8
basic block @ 0x41BF66 in function 0x41BE50
  or:
    api: kernel32.GetFileAttributes @ 0x41BF7F
basic block @ 0x41C063 in function 0x41BE50
  or:
    api: kernel32.GetFileAttributes @ 0x41C07C
basic block @ 0x41C876 in function 0x41C6E9
  or:
    api: kernel32.GetFileAttributes @ 0x41C87E
basic block @ 0x41C876 in function 0x41C6E9
  or:
    api: kernel32.GetFileAttributes @ 0x41C87E
basic block @ 0x41F92F in function 0x41F860
  or:
    api: kernel32.GetFileAttributes @ 0x41F937
basic block @ 0x41FC03 in function 0x41FAB0
  or:
    api: kernel32.GetFileAttributes @ 0x41FC0B

get file size (2 matches)
namespace  host-interaction/file-system/meta
author     michael.hunhoff@mandiant.com, anushka.virgaonkar@mandiant.com
scope      function
att&ck     Discovery::File and Directory Discovery [T1083]
mbc        Discovery::File and Directory Discovery [E1083]
function @ 0x404070
  or:
    api: kernel32.GetFileSize @ 0x4040FE
function @ 0x4061B0
  or:
    api: kernel32.GetFileSize @ 0x4061C9

set file attributes (4 matches)
namespace  host-interaction/file-system/meta
author     moritz.raabe@mandiant.com, michael.hunhoff@mandiant.com, anushka.virgaonkar@mandiant.com
scope      basic block
att&ck     Defense Evasion::File and Directory Permissions Modification [T1222]
mbc        File System::Set File Attributes [C0050]
basic block @ 0x4111F7 in function 0x410EB0
  or:
    api: kernel32.SetFileAttributes @ 0x411203
basic block @ 0x411CF2 in function 0x411BB0
  or:
    api: kernel32.SetFileAttributes @ 0x411CFE
basic block @ 0x41C888 in function 0x41C6E9
  or:
    api: kernel32.SetFileAttributes @ 0x41C894
basic block @ 0x41C888 in function 0x41C6E9
  or:
    api: kernel32.SetFileAttributes @ 0x41C894

read file on Windows (6 matches)
namespace  host-interaction/file-system/read
author     moritz.raabe@mandiant.com, anushka.virgaonkar@mandiant.com
scope      function
mbc        File System::Read File [C0051]
function @ 0x4061B0
  or:
    and:
      os: windows
      or:
        api: kernel32.ReadFile @ 0x406219
function @ 0x4726C5
  or:
    and:
      os: windows
      or:
        api: _read @ 0x47234C
function @ 0x4726D0
  or:
    and:
      os: windows
      or:
        api: _read @ 0x4724F0
function @ 0x475838
  or:
    and:
      os: windows
      or:
        api: kernel32.ReadFile @ 0x4758EA
function @ 0x475984
  or:
    and:
      os: windows
      or:
        api: kernel32.ReadFile @ 0x475A5F
function @ 0x475E74
  or:
    and:
      os: windows
      or:
        api: kernel32.ReadFile @ 0x476156

write file on Windows (3 matches)
namespace  host-interaction/file-system/write
author     william.ballenthin@mandiant.com, anushka.virgaonkar@mandiant.com
scope      function
mbc        File System::Writes File [C0052]
function @ 0x407770
  or:
    and:
      os: windows
      or:
        api: kernel32.WriteFile @ 0x40779B
function @ 0x47342C
  or:
    and:
      os: windows
      optional:
        basic block:
          or:
            number: 0x2 = FILE_WRITE_DATA @ 0x47367B
          or:
            number: 0x2 = FILE_WRITE_DATA @ 0x473650
      or:
        api: kernel32.WriteFile @ 0x4736EA, 0x473732
function @ 0x473D2A
  or:
    and:
      os: windows
      optional:
        basic block:
          or:
            number: 0x2 = FILE_WRITE_DATA @ 0x473DA1
          or:
            number: 0x2 = FILE_WRITE_DATA @ 0x473DBE
      or:
        api: kernel32.WriteFile @ 0x473E93

enumerate gui resources (4 matches)
namespace  host-interaction/gui
author     johnk3r, anushka.virgaonkar@mandiant.com
scope      function
att&ck     Discovery::Application Window Discovery [T1010]
function @ 0x41BE50
  or:
    api: EnumWindows @ 0x41DA26
function @ 0x41D9AB
  or:
    api: EnumWindows @ 0x41DA26
function @ 0x41FF10
  or:
    api: EnumWindows @ 0x41FF51
function @ 0x4204A0
  or:
    api: EnumWindows @ 0x42051D

find taskbar
namespace  host-interaction/gui/taskbar/find
author     moritz.raabe@mandiant.com
scope      function
mbc        Discovery::Taskbar Discovery [B0043]
function @ 0x417C80
  and:
    string: "Shell_TrayWnd" @ 0x417C9A, 0x417D5D
    match: find graphical window @ 0x417C80
      or:
        api: user32.FindWindowEx @ 0x417CA3, 0x417CB3, 0x417D66

find graphical window
namespace  host-interaction/gui/window/find
author     moritz.raabe@mandiant.com
scope      function
att&ck     Discovery::Application Window Discovery [T1010]
function @ 0x417C80
  or:
    api: user32.FindWindowEx @ 0x417CA3, 0x417CB3, 0x417D66

get graphical window text (2 matches)
namespace  host-interaction/gui/window/get-text
author     moritz.raabe@mandiant.com
scope      function
mbc        Discovery::Application Window Discovery [E1010]
function @ 0x411F70
  or:
    and:
      api: user32.GetWindowText @ 0x412209
function @ 0x41EDA0
  or:
    and:
      basic block:
        and:
          number: 0xD = WM_GETTEXT @ 0x41F096
          api: user32.SendMessage @ 0x41F080

hide graphical window (7 matches)
namespace  host-interaction/gui/window/hide
author     michael.hunhoff@mandiant.com
scope      basic block
att&ck     Defense Evasion::Hide Artifacts::Hidden Window [T1564.003]
basic block @ 0x4126E0 in function 0x4126E0
  and:
    number: 0x0 = SW_HIDE @ 0x4126E0, 0x4126EB
    api: user32.ShowWindow @ 0x4126E9, 0x4126F3, 0x412715, 0x41271A
basic block @ 0x4126E0 in function 0x4126E0
  and:
    number: 0x0 = SW_HIDE @ 0x4126E0, 0x4126EB
    api: user32.ShowWindow @ 0x4126E9, 0x4126F3, 0x412715, 0x41271A
basic block @ 0x419CFA in function 0x418FD0
  and:
    number: 0x0 = SW_HIDE @ 0x419CFA
    api: user32.ShowWindow @ 0x419CFD
basic block @ 0x41D2B3 in function 0x41D2AA
  and:
    number: 0x0 = SW_HIDE @ 0x41D2B3, 0x41D2C3
    api: user32.ShowWindow @ 0x41D2BB
basic block @ 0x41D2B3 in function 0x41D2AA
  and:
    number: 0x0 = SW_HIDE @ 0x41D2B3, 0x41D2C3
    api: user32.ShowWindow @ 0x41D2BB
basic block @ 0x41D304 in function 0x41D2FB
  and:
    number: 0x0 = SW_HIDE @ 0x41D304, 0x41D312
    api: user32.ShowWindow @ 0x41D30C
basic block @ 0x41D304 in function 0x41D2FB
  and:
    number: 0x0 = SW_HIDE @ 0x41D304, 0x41D312
    api: user32.ShowWindow @ 0x41D30C

print debug messages (2 matches)
namespace  host-interaction/log/debug/write-event
author     michael.hunhoff@mandiant.com
scope      function
function @ 0x469A3D
  or:
    api: kernel32.OutputDebugString @ 0x469A47
function @ 0x469A5A
  or:
    api: kernel32.OutputDebugString @ 0x46994C

check OS version
namespace  host-interaction/os/version
author     michael.hunhoff@mandiant.com, johnk3r
scope      function
att&ck     Discovery::System Information Discovery [T1082]
mbc        Discovery::System Information Discovery [E1082]
function @ 0x41A800
  and:
    match: get OS version @ 0x41A800
      or:
        api: VerifyVersionInfo @ 0x41AA46, 0x41AD7B, 0x41AEEA, 0x41B2D2, and 2 more...
        api: VerSetConditionMask @ 0x41AA14, 0x41AA18, 0x41AA1C, 0x41AD49, and 14 more...
    or:
      and:
        instruction:
          and:
            mnemonic: cmp @ 0x41B00A
            number: 0x5 = Windows 2000 @ 0x41B00A
        optional:
          instruction:
            and:
              mnemonic: cmp @ 0x41B582
              or:
                number: 0x0 @ 0x41B582
            and:
              mnemonic: cmp @ 0x41B404
              or:
                number: 0x0 @ 0x41B404
            and:
              mnemonic: cmp @ 0x41B504
              or:
                number: 0x0 @ 0x41B504
            and:
              mnemonic: cmp @ 0x41A90B
              or:
                number: 0x0 @ 0x41A90B
            and:
              mnemonic: cmp @ 0x41B50D
              or:
                number: 0x0 @ 0x41B50D
            and:
              mnemonic: cmp @ 0x41B311
              or:
                number: 0x0 @ 0x41B311
            and:
              mnemonic: cmp @ 0x41B3D7
              or:
                number: 0x0 @ 0x41B3D7
            and:
              mnemonic: cmp @ 0x41B118
              or:
                number: 0x0 @ 0x41B118
            and:
              mnemonic: cmp @ 0x41B31A
              or:
                number: 0x0 @ 0x41B31A
            and:
              mnemonic: cmp @ 0x41B2DC
              or:
                number: 0x0 @ 0x41B2DC
            and:
              mnemonic: cmp @ 0x41ABDD
              or:
                number: 0x1 = Windows XP @ 0x41ABDD
            and:
              mnemonic: cmp @ 0x41A91F
              or:
                number: 0x0 @ 0x41A91F
            and:
              mnemonic: cmp @ 0x41AFA1
              or:
                number: 0x1 = Windows XP @ 0x41AFA1
            and:
              mnemonic: cmp @ 0x41B164
              or:
                number: 0x0 @ 0x41B164
            and:
              mnemonic: cmp @ 0x41B36A
              or:
                number: 0x0 @ 0x41B36A
            and:
              mnemonic: cmp @ 0x41A8BB
              or:
                number: 0x0 @ 0x41A8BB
            and:
              mnemonic: cmp @ 0x41ACF1
              or:
                number: 0x2 = Windows XP 64-bit / Windows Server 2003 / Windows Server 2003 R2 @ 0x41ACF1
            and:
              mnemonic: cmp @ 0x41B171
              or:
                number: 0x0 @ 0x41B171
            and:
              mnemonic: cmp @ 0x41B579
              or:
                number: 0x0 @ 0x41B579
            and:
              mnemonic: cmp @ 0x41B1FA
              or:
                number: 0x0 @ 0x41B1FA
            and:
              mnemonic: cmp @ 0x41B3FB
              or:
                number: 0x0 @ 0x41B3FB

allocate thread local storage
namespace  host-interaction/process
author     michael.hunhoff@mandiant.com
scope      function
mbc        Process::Allocate Thread Local Storage [C0040]
function @ 0x463448
  or:
    api: kernel32.TlsAlloc @ 0x46347C

get thread local storage value
namespace  host-interaction/process
author     michael.hunhoff@mandiant.com
scope      function
function @ 0x4634C6
  and:
    api: kernel32.TlsGetValue @ 0x4634FF

create process on Windows (10 matches)
namespace  host-interaction/process/create
author     moritz.raabe@mandiant.com
scope      basic block
mbc        Process::Create Process [C0017]
basic block @ 0x40E107 in function 0x40DF6B
  or:
    api: shell32.ShellExecuteEx @ 0x40E18E
basic block @ 0x40E107 in function 0x40DF6B
  or:
    api: shell32.ShellExecuteEx @ 0x40E18E
basic block @ 0x40EC25 in function 0x40EA00
  or:
    api: shell32.ShellExecute @ 0x40EC2B
basic block @ 0x411D9E in function 0x411BB0
  or:
    api: shell32.ShellExecuteEx @ 0x411DB7
basic block @ 0x41C15C in function 0x41D24B
  or:
    api: shell32.ShellExecuteEx @ 0x41C1CB
basic block @ 0x41C167 in function 0x41BE50
  or:
    api: shell32.ShellExecuteEx @ 0x41C1CB
basic block @ 0x41CF90 in function 0x41CE72
  or:
    api: shell32.ShellExecute @ 0x41CFD3
basic block @ 0x41CF90 in function 0x41CE72
  or:
    api: shell32.ShellExecute @ 0x41CFD3
basic block @ 0x4206C8 in function 0x4204A0
  or:
    api: shell32.ShellExecuteEx @ 0x420763
basic block @ 0x420A87 in function 0x4204A0
  or:
    api: shell32.ShellExecuteEx @ 0x420A9C

enumerate process modules
namespace  host-interaction/process/modules/list
author     michael.hunhoff@mandiant.com, anushka.virgaonkar@mandiant.com
scope      function
att&ck     Discovery::Process Discovery [T1057]
function @ 0x411F70
  or:
    and:
      optional:
        or:
          api: kernel32.OpenProcess @ 0x412259
          api: kernel32.CloseHandle @ 0x41228A
      or:
        api: EnumProcessModules @ 0x41226E

terminate process (2 matches)
namespace  host-interaction/process/terminate
author     moritz.raabe@mandiant.com, michael.hunhoff@mandiant.com, anushka.virgaonkar@mandiant.com
scope      function
mbc        Process::Terminate Process [C0018]
function @ 0x418850
  or:
    and:
      or:
        api: kernel32.ExitProcess @ 0x41892A
function @ 0x45A4C5
  or:
    and:
      or:
        api: kernel32.TerminateProcess @ 0x45A4DD
        api: kernel32.ExitProcess @ 0x45A4EF

create thread (2 matches)
namespace  host-interaction/thread/create
author     moritz.raabe@mandiant.com, michael.hunhoff@mandiant.com, joakim@intezer.com, anushka.virgaonkar@mandiant.com
scope      basic block
mbc        Process::Create Thread [C0038]
basic block @ 0x413230 in function 0x413230
  or:
    and:
      os: windows
      or:
        api: _beginthread @ 0x413267
basic block @ 0x41F09E in function 0x41EDA0
  or:
    and:
      os: windows
      or:
        api: _beginthread @ 0x41F121

link function at runtime on Windows (8 matches)
namespace  linking/runtime-linking
author     moritz.raabe@mandiant.com, michael.hunhoff@mandiant.com
scope      function
att&ck     Execution::Shared Modules [T1129]
function @ 0x41A180
  and:
    os: windows
    or:
      api: kernel32.GetProcAddress @ 0x41A2F5
    optional:
      characteristic: indirect call @ 0x41A2FF, 0x41A35B, 0x41A39E, 0x41A3D9, and 26 more...
      api: kernel32.LoadLibrary @ 0x41A2E3
function @ 0x41A240
  and:
    os: windows
    or:
      api: kernel32.GetProcAddress @ 0x41A2F5
    optional:
      characteristic: indirect call @ 0x41A2FF, 0x41A35B, 0x41A39E, 0x41A3D9, and 26 more...
      api: kernel32.LoadLibrary @ 0x41A2E3
function @ 0x41A800
  and:
    os: windows
    or:
      api: kernel32.GetProcAddress @ 0x41A891
    optional:
      characteristic: indirect call @ 0x41A89B, 0x41A9BB, 0x41AA14, 0x41AA18, and 32 more...
      api: kernel32.LoadLibrary @ 0x41A87F
function @ 0x42244E
  and:
    os: windows
    or:
      api: kernel32.GetProcAddress @ 0x42247B, 0x422490
    optional:
      api: kernel32.GetModuleHandle @ 0x422465
function @ 0x42E2E2
  and:
    os: windows
    or:
      api: kernel32.GetProcAddress @ 0x42E36F
function @ 0x42E3D2
  and:
    os: windows
    or:
      api: kernel32.GetProcAddress @ 0x42E42E
function @ 0x45A269
  and:
    os: windows
    or:
      api: kernel32.GetProcAddress @ 0x45A274
function @ 0x45A564
  and:
    os: windows
    or:
      api: kernel32.GetProcAddress @ 0x45A5AB
    optional:
      characteristic: indirect call @ 0x45A5C2
      api: kernel32.GetModuleHandleEx @ 0x45A599

linked against CPP regex library
namespace   linking/static/cppregex
author      william.ballenthin@mandiant.com
scope       file
references  http://www.cplusplus.com/reference/regex/regex_error/
or:
  string: "regex_error(error_syntax)" = C++ STL regex library @ file+0x849F0
  string: "regex_error(error_collate): The expression contained an invalid collating element name." @ file+0x844E0

parse PE header (3 matches)
namespace  load-code/pe
author     moritz.raabe@mandiant.com
scope      function
att&ck     Execution::Shared Modules [T1129]
function @ 0x422EBA
  and:
    os: windows
    and:
      mnemonic: cmp @ 0x422EC9, 0x422ED3, 0x422EE0
      or:
        number: 0x4550 = IMAGE_NT_SIGNATURE (PE) @ 0x422ED3
      or:
        number: 0x5A4D = IMAGE_DOS_SIGNATURE (MZ) @ 0x422EC4
function @ 0x423B07
  and:
    os: windows
    and:
      mnemonic: cmp @ 0x423B18, 0x423B22, 0x423B2F, 0x423B35, and 1 more...
      or:
        number: 0x4550 = IMAGE_NT_SIGNATURE (PE) @ 0x423B22
      or:
        number: 0x5A4D = IMAGE_DOS_SIGNATURE (MZ) @ 0x423B13
function @ 0x479930
  and:
    os: windows
    and:
      mnemonic: cmp @ 0x47993B, 0x479945, 0x479954
      or:
        number: 0x4550 = IMAGE_NT_SIGNATURE (PE) @ 0x479945
      or:
        number: 0x5A4D = IMAGE_DOS_SIGNATURE (MZ) @ 0x479936

resolve function by parsing PE exports (6 matches)
namespace  load-code/pe
author     sara-rn
scope      function
function @ 0x413320
  and:
    os: windows
    or:
      characteristic: loop @ 0x413320
      mnemonic: movzx @ 0x413497, 0x4137B5, 0x4137C0, 0x4137C7
    and:
      offset: 0x3C = IMAGE_DOS_HEADER.PE.e_lfanew @ 0x413354, 0x413376, 0x413599, 0x4135C9, and 1 more...
      or:
        and:
          arch: i386
          offset: 0x78 = offset to IMAGE_DATA_DIRECTORY[IMAGE_DIRECTORY_ENTRY_EXPORT] @ 0x413508, 0x413522, 0x413653, 0x41368F, and 1 more...
      3 or more:
        offset: 0x14 = IMAGE_EXPORT_DIRECTORY.NumberOfFunctions @ 0x4135BB, 0x4135CE, 0x4135DB, 0x413625, and 2 more...
        offset: 0x24 = IMAGE_EXPORT_DIRECTORY.AddressOfNameOrdinals @ 0x413396, 0x4135DF, 0x4135FC, 0x413640, and 3 more...
        offset: 0x20 = IMAGE_EXPORT_DIRECTORY.AddressOfNames @ 0x41336E, 0x4133D7, 0x413406, 0x413636, and 2 more...
        offset: 0x18 = IMAGE_EXPORT_DIRECTORY.NumberOfNames @ 0x41358D, 0x413629, 0x413645, 0x41370A, and 1 more...
        offset: 0x1C = IMAGE_EXPORT_DIRECTORY.AddressOfFunctions @ 0x413600, 0x41362E, 0x4136F1, 0x413755
function @ 0x418FD0
  and:
    os: windows
    or:
      characteristic: loop @ 0x418FD0
      mnemonic: movzx @ 0x419024, 0x4194BC, 0x41950D, 0x4196D0, and 2 more...
    and:
      offset: 0x3C = IMAGE_DOS_HEADER.PE.e_lfanew @ 0x41926D, 0x419594, 0x4195E7, 0x4195F1
      or:
        and:
          arch: i386
          offset: 0x78 = offset to IMAGE_DATA_DIRECTORY[IMAGE_DIRECTORY_ENTRY_EXPORT] @ 0x419821, 0x41999D
      3 or more:
        offset: 0x14 = IMAGE_EXPORT_DIRECTORY.NumberOfFunctions @ 0x418FF0, 0x419219, 0x41927A, 0x4194DA, and 8 more...
        offset: 0x24 = IMAGE_EXPORT_DIRECTORY.AddressOfNameOrdinals @ 0x4195AD, 0x419CB4, 0x419CB8, 0x419CCB
        offset: 0x20 = IMAGE_EXPORT_DIRECTORY.AddressOfNames @ 0x4191AB, 0x419229, 0x4192A2, 0x41944D, and 9 more...
        offset: 0x18 = IMAGE_EXPORT_DIRECTORY.NumberOfNames @ 0x419000, 0x4191A8, 0x41923E, 0x41924C, and 6 more...
        offset: 0x1C = IMAGE_EXPORT_DIRECTORY.AddressOfFunctions @ 0x4191A4, 0x41923A, 0x419449, 0x4194DE, and 3 more...
function @ 0x41BE50
  and:
    os: windows
    or:
      characteristic: loop @ 0x41BE50
      mnemonic: movzx @ 0x41BE6C, 0x41BE94, 0x41D625
    and:
      offset: 0x3C = IMAGE_DOS_HEADER.PE.e_lfanew @ 0x41C922, 0x41C93F, 0x41CD41, 0x41CE40
      or:
        and:
          arch: i386
          offset: 0x78 = offset to IMAGE_DATA_DIRECTORY[IMAGE_DIRECTORY_ENTRY_EXPORT] @ 0x41DAD8
      3 or more:
        offset: 0x14 = IMAGE_EXPORT_DIRECTORY.NumberOfFunctions @ 0x41C632, 0x41C64E, 0x41C67D, 0x41C6C1, and 6 more...
        offset: 0x24 = IMAGE_EXPORT_DIRECTORY.AddressOfNameOrdinals @ 0x41C972, 0x41C9C3, 0x41CBE7, 0x41CD21, and 5 more...
        offset: 0x20 = IMAGE_EXPORT_DIRECTORY.AddressOfNames @ 0x41C605, 0x41DA5D, 0x41DB0C, 0x41DB10, and 4 more...
        offset: 0x18 = IMAGE_EXPORT_DIRECTORY.NumberOfNames @ 0x41C652, 0x41C695, 0x41C6A6, 0x41C6B5, and 9 more...
function @ 0x41E3D0
  and:
    os: windows
    or:
      characteristic: loop @ 0x41E3D0
      mnemonic: movzx @ 0x41E4B0, 0x41E4F4
    and:
      offset: 0x3C = IMAGE_DOS_HEADER.PE.e_lfanew @ 0x41E571, 0x41E9DA, 0x41EC87, 0x41EC98
      or:
        and:
          arch: i386
          offset: 0x78 = offset to IMAGE_DATA_DIRECTORY[IMAGE_DIRECTORY_ENTRY_EXPORT] @ 0x41E6B7
      3 or more:
        offset: 0x14 = IMAGE_EXPORT_DIRECTORY.NumberOfFunctions @ 0x41E5AD, 0x41E5FA, 0x41E6FC, 0x41EA3B, and 1 more...
        offset: 0x24 = IMAGE_EXPORT_DIRECTORY.AddressOfNameOrdinals @ 0x41EB36
        offset: 0x20 = IMAGE_EXPORT_DIRECTORY.AddressOfNames @ 0x41E542, 0x41E675, 0x41E9B6, 0x41EACB, and 1 more...
        offset: 0x18 = IMAGE_EXPORT_DIRECTORY.NumberOfNames @ 0x41E5FD, 0x41E714, 0x41EA2B, 0x41EA60
        offset: 0x1C = IMAGE_EXPORT_DIRECTORY.AddressOfFunctions @ 0x41E546, 0x41E5C2, 0x41E679, 0x41E9BA, and 1 more...
function @ 0x41EDA0
  and:
    os: windows
    or:
      characteristic: loop @ 0x41EDA0
    and:
      offset: 0x3C = IMAGE_DOS_HEADER.PE.e_lfanew @ 0x41F082, 0x41F08A, 0x41F171
      or:
        and:
          arch: i386
          offset: 0x78 = offset to IMAGE_DATA_DIRECTORY[IMAGE_DIRECTORY_ENTRY_EXPORT] @ 0x41EECA
      3 or more:
        offset: 0x14 = IMAGE_EXPORT_DIRECTORY.NumberOfFunctions @ 0x41F0EE, 0x41F169
        offset: 0x20 = IMAGE_EXPORT_DIRECTORY.AddressOfNames @ 0x41EE70, 0x41F02F
        offset: 0x18 = IMAGE_EXPORT_DIRECTORY.NumberOfNames @ 0x41F1B0
        offset: 0x1C = IMAGE_EXPORT_DIRECTORY.AddressOfFunctions @ 0x41F023, 0x41F02B
function @ 0x4B9140
  and:
    os: windows
    or:
      characteristic: loop @ 0x4B9140
      mnemonic: movzx @ 0x516982
    and:
      offset: 0x3C = IMAGE_DOS_HEADER.PE.e_lfanew @ 0x4BF5A1
      or:
        and:
          arch: i386
          offset: 0x78 = offset to IMAGE_DATA_DIRECTORY[IMAGE_DIRECTORY_ENTRY_EXPORT] @ 0x4BC991
      3 or more:
        offset: 0x24 = IMAGE_EXPORT_DIRECTORY.AddressOfNameOrdinals @ 0x4BE5C9
        offset: 0x20 = IMAGE_EXPORT_DIRECTORY.AddressOfNames @ 0x4ED93D, 0x5171B9
        offset: 0x18 = IMAGE_EXPORT_DIRECTORY.NumberOfNames @ 0x498D19, 0x4A5486
        offset: 0x1C = IMAGE_EXPORT_DIRECTORY.AddressOfFunctions @ 0x4F7BB2

create shortcut via IShellLink (2 matches)
namespace   persistence
author      matthew.williams@mandiant.com
scope       function
att&ck      Persistence::Boot or Logon Autostart Execution::Shortcut Modification [T1547.009]
references  https://docs.microsoft.com/en-us/windows/win32/shell/links#creating-a-shortcut-and-a-folder-shortcut-to-a-file
function @ 0x41BE50
  and:
    offset: 0x50 = psl->SetPath @ 0x41C68C, 0x41CF8C, 0x41DB82, 0x41DC62, and 1 more...
    offset: 0x18 = ppf->Save @ 0x41C652, 0x41C695, 0x41C6A6, 0x41C6B5, and 9 more...
    api: ole32.CoCreateInstance @ 0x41C644
    bytes: 0114020000000000c000000000000046 = CLSID_ShellLink @ 0x41C63F
    bytes: 0b01000000000000c000000000000046 = IID_IPersistFile @ 0x41C657
    or:
      bytes: f914020000000000c000000000000046 = IID_IShellLinkW @ 0x41C637
function @ 0x41C5B4
  and:
    offset: 0x50 = psl->SetPath @ 0x41C68C
    offset: 0x18 = ppf->Save @ 0x41C652, 0x41C695, 0x41C6A6, 0x41C6B5
    api: ole32.CoCreateInstance @ 0x41C644
    bytes: 0114020000000000c000000000000046 = CLSID_ShellLink @ 0x41C63F
    bytes: 0b01000000000000c000000000000046 = IID_IPersistFile @ 0x41C657
    or:
      bytes: f914020000000000c000000000000046 = IID_IShellLinkW @ 0x41C637

identify system language via API
namespace  targeting/language
author     william.ballenthin@mandiant.com
scope      function
att&ck     Discovery::System Location Discovery::System Language Discovery [T1614.001]
function @ 0x4215A0
  and:
    os: windows
    or:
      api: GetUserDefaultUILanguage @ 0x42169E
      api: GetSystemDefaultUILanguage @ 0x42183E, 0x4219BA



